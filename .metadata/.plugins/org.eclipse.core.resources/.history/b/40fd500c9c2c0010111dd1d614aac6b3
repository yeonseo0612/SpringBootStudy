package com.example.todo.security;

import java.time.Instant;
import java.time.temporal.ChronoUnit;
import java.util.Date;

import org.springframework.stereotype.Service;

import com.example.todo.model.UserEntity;

import lombok.extern.slf4j.Slf4j;

@Slf4j
@Service
public class TokenProvider {
	
	//비밀키
	private static final String SECRET_KEY = "027998c75eeba84a159316567af6dd036a4f9be9dd998d8b63a55e085d34b2d4802118f20facff2044ce24952345157904685ee9afa66d878c74be7038f1ce4605a574293883854c0d35af1b33bfaaa58be4b2f92dc5b7edf29fc57d2af0e3d81f68d730f06e5ccf5ab743e8cd51270dbbc4e723e3015c52c7146b9eb838d75abd9d129b28f2dcfa98dc6c61061b428a3959818929aed3bccf6b0a156e6bc5b2609dcc2b7f6801da9154a944c399a51ed6806a823473efdbd8514dcf0ddfb584d84aa2e6d3c35956383de64aa73412f46f94fa7d065c056c4ce6afab4dd4281099b0bdf597ba6f177267ee7489fd06a37c29ea7f0eb290871624d47e415368ad";

	
	//토큰을 만드는 메서드
	public String create(UserEntity entity) {
		//토큰 만료시간을 설정
		//현재 시각 + 1일
		
		
		Date expiryDate = Date.from(Instant.now().plus(1,ChronoUnit.DAYS));
		//import시 java.sql이 아니라 util로 해야함
		
		return Jwts.builder()
				// header에 들어갈 내용 및 서명을 하기 위한 SECRET_KEY
				.signWith(SignatureAlgorithm.HS512, SECRET_KEY)
				// payload에 들어갈 내용
				.setSubject(UserEntity.getId()) // sub
				.setIssuer("demo app") // iss
				.setIssuedAt(new Date()) // iat
				.setExpiration(expiryDate) // exp
				.compact();

	}
}
